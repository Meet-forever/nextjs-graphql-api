import { ApolloServer, gql } from "apollo-server-micro";
import { PageConfig } from "next";
import { ApolloServerPluginLandingPageGraphQLPlayground } from "apollo-server-core"
import Cors from "micro-cors";
const cors = Cors();

const fakeData = [
    {
        "id": 5706,
        "uid": "7ab60632-68b7-41d2-aff3-04c1b58bb462",
        "city": "East Sherman",
        "street_name": "Effertz Via",
        "street_address": "48764 Sang Pass",
        "secondary_address": "Suite 904",
        "building_number": "8341",
        "mail_box": "PO Box 2769",
        "community": "Park Heights",
        "zip_code": "50371-5338",
        "zip": "38585-2786",
        "postcode": "00322-2713",
        "time_zone": "Europe/Madrid",
        "street_suffix": "Station",
        "city_suffix": "haven",
        "city_prefix": "West",
        "state": "Tennessee",
        "state_abbr": "CO",
        "country": "Sierra Leone",
        "country_code": "CL",
        "latitude": -78.39539502345234,
        "longitude": 79.32985768291036,

    },
    {
        "id": 8944,
        "uid": "ec5f406a-e8ff-4564-8d81-5617a7f7b196",
        "city": "Hillsburgh",
        "street_name": "Vernon Flat",
        "street_address": "30153 Roob Parkways",
        "secondary_address": "Suite 607",
        "building_number": "53069",
        "mail_box": "PO Box 3898",
        "community": "University Oaks",
        "zip_code": "33020",
        "zip": "36689",
        "postcode": "59040",
        "time_zone": "Asia/Magadan",
        "street_suffix": "Trace",
        "city_suffix": "shire",
        "city_prefix": "Lake",
        "state": "West Virginia",
        "state_abbr": "DE",
        "country": "Cambodia",
        "country_code": "NU",
        "latitude": -19.16337313085519,
        "longitude": -91.00218802377184,

    },
    {
        "id": 8805,
        "uid": "61686b6a-beca-440d-99fe-bcbcd3318d05",
        "city": "Port Meggan",
        "street_name": "Bettina Viaduct",
        "street_address": "98015 Bartoletti Mission",
        "secondary_address": "Suite 906",
        "building_number": "834",
        "mail_box": "PO Box 438",
        "community": "Eagle Acres",
        "zip_code": "20899-4321",
        "zip": "71691-3843",
        "postcode": "56058-5858",
        "time_zone": "Africa/Nairobi",
        "street_suffix": "Oval",
        "city_suffix": "land",
        "city_prefix": "North",
        "state": "Utah",
        "state_abbr": "SD",
        "country": "Reunion",
        "country_code": "TO",
        "latitude": 82.25988778429036,
        "longitude": -55.43971414672704,

    },
    {
        "id": 7819,
        "uid": "75e22c42-3e20-4fbf-a7f3-40e1173b5065",
        "city": "Baumbachbury",
        "street_name": "Audry Glens",
        "street_address": "7686 Willene Streets",
        "secondary_address": "Suite 909",
        "building_number": "63412",
        "mail_box": "PO Box 2641",
        "community": "Eagle Square",
        "zip_code": "96895",
        "zip": "70191",
        "postcode": "58425",
        "time_zone": "Asia/Tehran",
        "street_suffix": "Harbors",
        "city_suffix": "port",
        "city_prefix": "West",
        "state": "Georgia",
        "state_abbr": "OR",
        "country": "Iraq",
        "country_code": "GM",
        "latitude": -16.563587154444775,
        "longitude": 148.52361054970993,

    },
    {
        "id": 998,
        "uid": "f9fe9bf3-6067-4a9d-8ba0-79562b0efd7b",
        "city": "Port Marvin",
        "street_name": "Ora Island",
        "street_address": "48062 Meta Flat",
        "secondary_address": "Apt. 277",
        "building_number": "486",
        "mail_box": "PO Box 322",
        "community": "Paradise Court",
        "zip_code": "56373",
        "zip": "83409",
        "postcode": "13492-1229",
        "time_zone": "Europe/Moscow",
        "street_suffix": "Courts",
        "city_suffix": "shire",
        "city_prefix": "Lake",
        "state": "New Jersey",
        "state_abbr": "FL",
        "country": "Timor-Leste",
        "country_code": "KI",
        "latitude": -33.32465070862343,
        "longitude": 60.607574270638,

    },
    {
        "id": 2128,
        "uid": "d21d3ef6-efc0-4842-87ed-980ef6bf2033",
        "city": "Spinkaport",
        "street_name": "Padberg Drive",
        "street_address": "22375 Marc Ramp",
        "secondary_address": "Apt. 810",
        "building_number": "32329",
        "mail_box": "PO Box 1001",
        "community": "Royal Creek",
        "zip_code": "57252-2446",
        "zip": "86464",
        "postcode": "89461",
        "time_zone": "America/Caracas",
        "street_suffix": "Garden",
        "city_suffix": "port",
        "city_prefix": "North",
        "state": "Idaho",
        "state_abbr": "NC",
        "country": "Libyan Arab Jamahiriya",
        "country_code": "SA",
        "latitude": -29.226606759065128,
        "longitude": -43.94597715821939,

    },
    {
        "id": 7261,
        "uid": "597cd49a-414b-4489-90d7-9849483331c1",
        "city": "North Earthaberg",
        "street_name": "Amada Creek",
        "street_address": "19193 Harber Corner",
        "secondary_address": "Apt. 587",
        "building_number": "920",
        "mail_box": "PO Box 629",
        "community": "Pine Estates",
        "zip_code": "16873",
        "zip": "98443-2965",
        "postcode": "97384-2828",
        "time_zone": "Asia/Rangoon",
        "street_suffix": "Mews",
        "city_suffix": "haven",
        "city_prefix": "New",
        "state": "Alaska",
        "state_abbr": "MN",
        "country": "Israel",
        "country_code": "JP",
        "latitude": 31.676431896783825,
        "longitude": -68.65326596480446,

    },
    {
        "id": 4915,
        "uid": "4cd3f08b-1d47-4539-942e-cd99d14c77ba",
        "city": "Port Vernside",
        "street_name": "Feest Lodge",
        "street_address": "278 Therese Spur",
        "secondary_address": "Apt. 263",
        "building_number": "10397",
        "mail_box": "PO Box 867",
        "community": "Willow Oaks",
        "zip_code": "75244",
        "zip": "42716",
        "postcode": "54746",
        "time_zone": "Europe/Vilnius",
        "street_suffix": "Trafficway",
        "city_suffix": "town",
        "city_prefix": "Lake",
        "state": "California",
        "state_abbr": "NY",
        "country": "Romania",
        "country_code": "HT",
        "latitude": 2.669848615432059,
        "longitude": -126.8624981106568,

    },
    {
        "id": 5366,
        "uid": "1b880aaa-8138-4e5c-9f34-22d73b315861",
        "city": "Hollishaven",
        "street_name": "Deirdre Valleys",
        "street_address": "44830 Eliseo Viaduct",
        "secondary_address": "Apt. 871",
        "building_number": "263",
        "mail_box": "PO Box 2449",
        "community": "University Gardens",
        "zip_code": "21438",
        "zip": "21392-3354",
        "postcode": "04154-3105",
        "time_zone": "Africa/Algiers",
        "street_suffix": "Rapids",
        "city_suffix": "view",
        "city_prefix": "West",
        "state": "South Carolina",
        "state_abbr": "SC",
        "country": "Chad",
        "country_code": "CN",
        "latitude": -76.50171860452892,
        "longitude": 119.8997573856717,

    },
    {
        "id": 3814,
        "uid": "3ff300ff-8181-41df-b926-f9b75f590f5e",
        "city": "Lucienborough",
        "street_name": "Meagan Turnpike",
        "street_address": "81418 Dave Pass",
        "secondary_address": "Suite 968",
        "building_number": "1161",
        "mail_box": "PO Box 37",
        "community": "Park Heights",
        "zip_code": "84295",
        "zip": "54776-6325",
        "postcode": "92348-9217",
        "time_zone": "America/Los_Angeles",
        "street_suffix": "Springs",
        "city_suffix": "stad",
        "city_prefix": "South",
        "state": "South Dakota",
        "state_abbr": "WY",
        "country": "Tonga",
        "country_code": "ID",
        "latitude": -80.04166030822172,
        "longitude": 136.12055700609102,

    },
    {
        "id": 3612,
        "uid": "8a8be46a-7373-4cdf-894a-fe841488a25b",
        "city": "Welchmouth",
        "street_name": "Skiles Squares",
        "street_address": "40569 Jakubowski Mews",
        "secondary_address": "Suite 992",
        "building_number": "946",
        "mail_box": "PO Box 87",
        "community": "Royal Court",
        "zip_code": "37415",
        "zip": "35278-8022",
        "postcode": "63387",
        "time_zone": "America/Bogota",
        "street_suffix": "Vista",
        "city_suffix": "furt",
        "city_prefix": "North",
        "state": "Washington",
        "state_abbr": "MD",
        "country": "Philippines",
        "country_code": "MD",
        "latitude": 25.52008367103268,
        "longitude": -64.79658759827583,

    },
    {
        "id": 4387,
        "uid": "c5101568-1a31-4e2f-a177-5fe2301aa5cb",
        "city": "West Bethel",
        "street_name": "Clinton Drive",
        "street_address": "5117 Genevie Stream",
        "secondary_address": "Suite 924",
        "building_number": "3695",
        "mail_box": "PO Box 56",
        "community": "Pine Place",
        "zip_code": "59909",
        "zip": "90122-7443",
        "postcode": "17448",
        "time_zone": "Asia/Muscat",
        "street_suffix": "Lodge",
        "city_suffix": "land",
        "city_prefix": "South",
        "state": "New York",
        "state_abbr": "AK",
        "country": "French Polynesia",
        "country_code": "CZ",
        "latitude": 28.007730342657922,
        "longitude": -37.07658544531756,

    },
    {
        "id": 3894,
        "uid": "b361f79c-3676-4e2c-8745-e64e61fc5cbb",
        "city": "Port Raulport",
        "street_name": "Wyman Groves",
        "street_address": "1391 Jast Junction",
        "secondary_address": "Apt. 585",
        "building_number": "5844",
        "mail_box": "PO Box 49",
        "community": "Autumn Creek",
        "zip_code": "92365",
        "zip": "59125",
        "postcode": "28072-8504",
        "time_zone": "Australia/Melbourne",
        "street_suffix": "Forks",
        "city_suffix": "land",
        "city_prefix": "Port",
        "state": "Hawaii",
        "state_abbr": "UT",
        "country": "Isle of Man",
        "country_code": "VU",
        "latitude": 72.01572041222735,
        "longitude": -49.20361133863,

    },
    {
        "id": 2028,
        "uid": "86b1ecc8-2b5e-4d73-9519-2e953d29ccff",
        "city": "Konopelskiberg",
        "street_name": "Schuster Glens",
        "street_address": "52889 Fredericka Plaza",
        "secondary_address": "Suite 530",
        "building_number": "22706",
        "mail_box": "PO Box 6650",
        "community": "Autumn Place",
        "zip_code": "27527-4675",
        "zip": "11461-0304",
        "postcode": "01517-0603",
        "time_zone": "Asia/Colombo",
        "street_suffix": "Light",
        "city_suffix": "haven",
        "city_prefix": "North",
        "state": "Ohio",
        "state_abbr": "AL",
        "country": "Dominican Republic",
        "country_code": "US",
        "latitude": -49.46183618323986,
        "longitude": 158.2250654920556,

    },
    {
        "id": 5605,
        "uid": "fca4e2bc-dc67-49f2-984b-e2dbd3494402",
        "city": "New Sigridtown",
        "street_name": "Freda Lights",
        "street_address": "12047 Dicki Flats",
        "secondary_address": "Suite 546",
        "building_number": "33067",
        "mail_box": "PO Box 59",
        "community": "Willow Estates",
        "zip_code": "81759-2743",
        "zip": "05142-4252",
        "postcode": "58129",
        "time_zone": "Pacific/Pago_Pago",
        "street_suffix": "Row",
        "city_suffix": "side",
        "city_prefix": "New",
        "state": "Michigan",
        "state_abbr": "VA",
        "country": "Saint Barthelemy",
        "country_code": "KN",
        "latitude": -18.270038479778194,
        "longitude": -7.3123011388802865,

    },
    {
        "id": 383,
        "uid": "17a92bed-5836-4946-8469-d8efc59e611e",
        "city": "Fadelland",
        "street_name": "McGlynn Key",
        "street_address": "894 Edwardo Hollow",
        "secondary_address": "Suite 933",
        "building_number": "599",
        "mail_box": "PO Box 685",
        "community": "Willow Place",
        "zip_code": "07098-5590",
        "zip": "65149",
        "postcode": "67137",
        "time_zone": "Asia/Tokyo",
        "street_suffix": "Branch",
        "city_suffix": "town",
        "city_prefix": "North",
        "state": "Hawaii",
        "state_abbr": "DE",
        "country": "Cuba",
        "country_code": "TT",
        "latitude": 78.74067949601064,
        "longitude": -122.17487133447092,

    },
    {
        "id": 3867,
        "uid": "5d39bdcb-cffc-41ef-8f3d-29f27623e8d6",
        "city": "New Beau",
        "street_name": "Hodkiewicz Row",
        "street_address": "57027 Gleason Lodge",
        "secondary_address": "Suite 454",
        "building_number": "45026",
        "mail_box": "PO Box 735",
        "community": "Park Heights",
        "zip_code": "73452-9552",
        "zip": "58914-7727",
        "postcode": "58902-6638",
        "time_zone": "Asia/Magadan",
        "street_suffix": "Course",
        "city_suffix": "bury",
        "city_prefix": "New",
        "state": "Arkansas",
        "state_abbr": "NY",
        "country": "Bangladesh",
        "country_code": "PY",
        "latitude": 71.60613677965972,
        "longitude": 153.18153122568782,

    },
    {
        "id": 3583,
        "uid": "999054df-008f-4339-b4ab-4f2f693736b1",
        "city": "West Luther",
        "street_name": "Shakita Coves",
        "street_address": "9118 Lanelle Walks",
        "secondary_address": "Apt. 113",
        "building_number": "147",
        "mail_box": "PO Box 166",
        "community": "Pine Heights",
        "zip_code": "41552",
        "zip": "82928-2466",
        "postcode": "58202-5332",
        "time_zone": "Europe/Bratislava",
        "street_suffix": "Street",
        "city_suffix": "ton",
        "city_prefix": "Lake",
        "state": "Texas",
        "state_abbr": "PA",
        "country": "Singapore",
        "country_code": "BN",
        "latitude": 48.33718809601129,
        "longitude": -169.34953590289496,

    },
    {
        "id": 881,
        "uid": "6777c28e-9c48-4687-a503-704532f08d81",
        "city": "South Joshuachester",
        "street_name": "Jalisa Spring",
        "street_address": "551 Felton Estates",
        "secondary_address": "Suite 286",
        "building_number": "5591",
        "mail_box": "PO Box 8616",
        "community": "Park Place",
        "zip_code": "22464-3410",
        "zip": "34391",
        "postcode": "02628",
        "time_zone": "Europe/Bratislava",
        "street_suffix": "Crossing",
        "city_suffix": "bury",
        "city_prefix": "West",
        "state": "Oregon",
        "state_abbr": "OR",
        "country": "British Indian Ocean Territory (Chagos Archipelago)",
        "country_code": "YE",
        "latitude": -5.050033402626497,
        "longitude": 168.08273986282256,

    },
    {
        "id": 529,
        "uid": "6deba540-a546-4a3d-8462-38fe1c85ec94",
        "city": "Port Calebland",
        "street_name": "Farrell Mountain",
        "street_address": "6140 Quitzon Circle",
        "secondary_address": "Apt. 606",
        "building_number": "18154",
        "mail_box": "PO Box 310",
        "community": "Paradise Court",
        "zip_code": "25864-0019",
        "zip": "39115",
        "postcode": "82880-1246",
        "time_zone": "America/Phoenix",
        "street_suffix": "Track",
        "city_suffix": "view",
        "city_prefix": "Lake",
        "state": "Rhode Island",
        "state_abbr": "DE",
        "country": "Kyrgyz Republic",
        "country_code": "WS",
        "latitude": 66.93022100125154,
        "longitude": -98.79701127637283,
    }
]

export const config: PageConfig = {
    api: {
        bodyParser: false,
    },
};

const typeDefs = gql`
    type Place{
        id: ID,
        uid: String,
        city: String,
        street_name: String,
        street_address: String,
        secondary_address: String,
        building_number: String,
        mail_box: String,
        community: String,
        zip_code: String,
        zip: String,
        postcode: String,
        time_zone: String,
        street_suffix: String,
        city_suffix: String,
        city_prefix: String,
        state: String,
        state_abbr: String,
        country: String,
        country_code: String,
        latitude: Int,
        longitude: Int,
    }
    type Query{
        hello: String!,
        place(id: Int):Place,
        places: [Place]
    }
`;

const resolvers = {
    Query: {
        hello: () => "World!",
        place: (parent: any, args: any) => {
            return fakeData.find(data => data.id === args.id)
        },
        places: () => fakeData
    }
}

const server = new ApolloServer({
    typeDefs,
    resolvers,
    introspection: true,
    plugins: [ApolloServerPluginLandingPageGraphQLPlayground()]
})

const startServer = server.start(); // Always start outside the function!!

export default cors(async (req, res) => {
    await startServer;
    await server.createHandler({
        path: "/api/graphql",
    })(req, res);
})